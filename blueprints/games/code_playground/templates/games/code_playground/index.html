<!DOCTYPE html>
<html lang="zh-CN" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>实时画布 · Code Playground</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer data-babel-loader></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css" integrity="sha512-WzCKsCg1o1t4bm/FkV0GUaRcY74to/zl+VX6CLGrhPMvAtGjAc+iDZf85VkpLuEDiMxDlRn2OKdp5AybG9YLow==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
      :root {
        color-scheme: dark;
        --bg: #0f172a;
        --panel: rgba(15, 23, 42, 0.84);
        --panel-border: rgba(148, 163, 184, 0.16);
        --accent: #38bdf8;
        --text-main: #e2e8f0;
        --text-muted: #94a3b8;
        --code-bg: rgba(15, 23, 42, 0.92);
        --preview-bg: #020617;
        font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }
      * { box-sizing: border-box; }
      html, body { margin: 0; height: 100%; background: radial-gradient(circle at top left, rgba(14,165,233,0.25), transparent 45%), radial-gradient(circle at bottom right, rgba(244,114,182,0.18), transparent 40%), var(--bg); color: var(--text-main); }
      body { display: flex; flex-direction: column; }
      header { padding: 1.25rem 1.75rem 0.75rem; display: flex; align-items: center; justify-content: space-between; gap: 1rem; }
      header h1 { font-size: 1.4rem; font-weight: 600; margin: 0; letter-spacing: 0.01em; }
      header p { margin: 0; color: var(--text-muted); font-size: 0.95rem; }
      main { flex: 1; display: grid; grid-template-columns: minmax(320px, 42%) 1fr; gap: 1rem; padding: 0 1.75rem 1.75rem; }
      .panel { background: var(--panel); border: 1px solid var(--panel-border); border-radius: 1.25rem; backdrop-filter: blur(28px); box-shadow: 0 40px 120px rgba(15, 23, 42, 0.45); display: flex; flex-direction: column; overflow: hidden; position: relative; }
      .panel::after { content: ""; position: absolute; inset: 0; border-radius: inherit; pointer-events: none; box-shadow: inset 0 1px 0 rgba(255,255,255,0.06); }
      .panel-header { padding: 1rem 1.25rem; border-bottom: 1px solid rgba(148, 163, 184, 0.12); display: flex; align-items: center; justify-content: space-between; gap: 1rem; }
      .panel-actions { display: flex; align-items: center; gap: 0.5rem; }
      .panel-title { font-size: 0.9rem; font-weight: 600; letter-spacing: 0.05em; text-transform: uppercase; color: var(--text-muted); }
      .status-label { font-size: 0.78rem; color: var(--accent); background: rgba(56, 189, 248, 0.12); padding: 0.35rem 0.7rem; border-radius: 999px; display: inline-flex; align-items: center; gap: 0.35rem; }
      .status-dot { width: 0.55rem; height: 0.55rem; background: var(--accent); border-radius: 50%; box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.35); animation: pulse 2s infinite; }
      @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.35); } 70% { box-shadow: 0 0 0 0.65rem rgba(56, 189, 248, 0); } 100% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0); } }
      textarea { flex: 1; width: 100%; background: var(--code-bg); color: #f8fafc; border: none; resize: none; padding: 1.25rem; font-size: 0.82rem; line-height: 1.45; font-family: 'JetBrains Mono', 'Fira Code', 'SFMono-Regular', Menlo, Monaco, Consolas, monospace; outline: none; }
      textarea::selection { background: rgba(56, 189, 248, 0.28); }
      .editor-toolbar { padding: 0.65rem 1.25rem; display: flex; align-items: center; justify-content: space-between; gap: 0.75rem; border-bottom: 1px solid rgba(148, 163, 184, 0.1); }
      .editor-toolbar button { border: none; background: rgba(148, 163, 184, 0.12); color: var(--text-main); padding: 0.45rem 0.9rem; font-size: 0.75rem; border-radius: 0.7rem; cursor: pointer; display: inline-flex; align-items: center; gap: 0.4rem; transition: background 0.2s ease, transform 0.2s ease; }
      .editor-toolbar button:hover { background: rgba(148, 163, 184, 0.2); transform: translateY(-1px); }
      .editor-toolbar button:active { transform: translateY(1px); }
      .editor-toolbar .badge { background: rgba(56, 189, 248, 0.16); color: var(--accent); padding: 0.25rem 0.6rem; border-radius: 999px; font-weight: 500; font-size: 0.7rem; }
      .preview-stage { flex: 1; background: var(--preview-bg); position: relative; overflow: hidden; }
      iframe { border: none; width: 100%; height: 100%; background: transparent; }
      .preview-overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(15, 23, 42, 0.78); color: #f87171; font-size: 0.88rem; line-height: 1.5; padding: 1.5rem; text-align: center; opacity: 0; pointer-events: none; transition: opacity 0.25s ease; }
      .preview-overlay.visible { opacity: 1; pointer-events: auto; }
      .retry-button { display: none; background: rgba(56, 189, 248, 0.14); border: 1px solid rgba(56, 189, 248, 0.35); color: var(--accent); padding: 0.35rem 0.7rem; border-radius: 999px; font-size: 0.7rem; letter-spacing: 0.02em; cursor: pointer; transition: background 0.2s ease, transform 0.2s ease; }
      .retry-button:hover { background: rgba(56, 189, 248, 0.24); transform: translateY(-1px); }
      .retry-button:active { transform: translateY(0); }
      .retry-button.is-visible { display: inline-flex; align-items: center; gap: 0.35rem; }
      .bottom-hint { margin: 0 1.75rem 1rem; color: rgba(148, 163, 184, 0.65); font-size: 0.75rem; text-align: right; }
      @media (max-width: 1200px) { main { grid-template-columns: 1fr; } header { flex-direction: column; align-items: flex-start; } .panel { min-height: 360px; } }
    </style>
  </head>
  <body>
    <header>
      <div>
        <h1>实时画布 · Code Playground</h1>
        <p>在左侧编写 React / JSX，右侧画布会即时刷新。支持保存到浏览器本地。</p>
      </div>
      <div class="status-label" id="status-label">
        <span class="status-dot"></span>
        <span>准备就绪</span>
      </div>
    </header>
    <main>
      <section class="panel" aria-label="代码编辑器">
        <div class="editor-toolbar">
          <div class="badge">React / JSX</div>
          <div style="display:flex; gap:0.5rem; align-items:center;">
            <button type="button" data-action="format">格式化</button>
            <button type="button" data-action="reset">重置示例</button>
            <button type="button" data-action="copy">复制代码</button>
          </div>
        </div>
        <textarea id="code-editor" spellcheck="false"></textarea>
      </section>
      <section class="panel" aria-label="实时预览">
        <div class="panel-header">
          <div class="panel-title">实时预览</div>
          <div class="panel-actions">
            <div class="badge" id="compile-info">等待中</div>
            <button type="button" class="retry-button" data-action="reload-compiler" aria-label="重新加载编译器">
              <span aria-hidden="true">⟳</span>
              <span>重试编译器</span>
            </button>
          </div>
        </div>
        <div class="preview-stage">
          <iframe id="preview-frame" title="实时预览画布"></iframe>
          <div class="preview-overlay" id="error-overlay" role="alert"></div>
        </div>
      </section>
    </main>
    <p class="bottom-hint">导入语句会自动映射至 CDN（React / ReactDOM / lucide-react）。</p>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.9/beautify.min.js" integrity="sha512-4XcWoaK0CMgfHdCqkfNNpJBWlAbIYW/W2PASi6DPd7OJbRRqtD9h5pz50jdK5Zk90un0nLBKBPXn1HULICwhfQ==" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.9/beautify-js.min.js" integrity="sha512-XcZW9N6byN1Nsx3Rp3XIan+FJxuxMxDPZWS9Vyuk3F7S3w7Dnk3a1JpN96CBvs1+qsSVqSdz+CA0nVddOZXS6Q==" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>
    <script defer src="{{ url_for('code_playground.static', filename='main.js') }}"></script>
  </body>
</html>
