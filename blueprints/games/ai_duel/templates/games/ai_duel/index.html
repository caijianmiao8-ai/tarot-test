<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>AI 斗蛐蛐 · 对战间</title>

  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Noto+Sans+SC:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('ai_duel.static', filename='main.css') }}">
</head>
<body id="duel-app">
  <!-- 顶栏 -->
  <header class="topbar">
    <div class="brand">
      <span class="vox"></span>
      <h1>AI 斗蛐蛐</h1>
      <small>若水的对战间</small>
    </div>
    <div class="quota" id="quota">—</div>
  </header>

  <!-- 舞台（居中三栏） -->
  <main class="stage">
    <aside class="side side-a">
      <div class="bot-card">
        <div class="bot-avatar a"></div>
        <div class="bot-meta">
          <div class="bot-name" id="nameA">A 方</div>
          <div class="bot-model" id="modelAName">模型待选</div>
        </div>
      </div>
    </aside>

    <!-- 聊天区（更宽，IM风气泡） -->
    <section class="chat" id="chat">
      <div class="banner">
        <div class="banner-title">准备开战</div>
        <div class="banner-note">输入题目或直接点快捷按钮；高级设置在底部。</div>
        <div class="quick-row">
          <button class="chip" data-topic="薯条好吃还是汉堡好吃？">薯条 vs 汉堡</button>
          <button class="chip" data-topic="AI 会在十年内取代程序员吗？">AI vs 程序员</button>
          <button class="chip" data-topic="猫更聪明还是狗更聪明？">猫 vs 狗</button>
          <button class="chip" data-topic="远程办公是否更高效？">远程 vs 办公室</button>
          <button class="chip" data-topic="极简设计是否优于功能堆叠？">极简 vs 全能</button>
        </div>
      </div>
    </section>

    <aside class="side side-b">
      <div class="bot-card">
        <div class="bot-avatar b"></div>
        <div class="bot-meta">
          <div class="bot-name" id="nameB">B 方</div>
          <div class="bot-model" id="modelBName">模型待选</div>
        </div>
      </div>
    </aside>
  </main>

  <!-- 底部操作条 -->
  <div class="dock">
    <div class="dock-left">
      <input id="topic" class="topic-input" type="text" placeholder="输入题目，例如：薯条好吃还是汉堡好吃？">
      <button id="btn-start" class="btn primary">开始对战</button>
      <button id="btn-stop" class="btn danger" disabled>停止</button>
    </div>
    <div class="dock-right">
      <button id="btn-toggle" class="btn ghost">⚙ 设置</button>
    </div>
  </div>

  <!-- 底部设置面板（含：预设生成、裁判、回答长度 3 档） -->
  <div class="sheet" id="sheet">
    <div class="sheet-handle" id="sheetClose" title="收起">—</div>
    <div class="sheet-content">
      <div class="sheet-grid">
        <div class="sheet-col">
          <div class="group">
            <label>对战回合（1-10）</label>
            <input id="rounds" type="number" min="1" max="10" value="4">
          </div>

          <div class="group">
            <label>模型 A</label>
            <select id="modelA"></select>
          </div>

          <div class="group">
            <label>模型 B</label>
            <select id="modelB"></select>
          </div>

          <div class="group">
            <label>一句设定（自动扩展成双方预设）</label>
            <div class="row">
              <input id="seed" type="text" placeholder="如：两位美食评论家围绕快餐健康性展开讨论">
              <button id="btn-gen" class="btn secondary">✨ 生成预设</button>
            </div>
            <small class="muted">依赖后端 /api/presets；失败会退化为把这句设定填入 A/B。</small>
          </div>

          <div class="group small">
            <label>回答长度</label>
            <div class="seg" id="lenSeg">
              <button class="seg-btn active" data-len="short">短（1–2句）</button>
              <button class="seg-btn" data-len="medium">中（2–4句）</button>
              <button class="seg-btn" data-len="long">长（4–6句）</button>
            </div>
          </div>
        </div>

        <div class="sheet-col">
          <div class="group">
            <label>角色 A 预设</label>
            <textarea id="presetA" rows="4" placeholder="如：美食科学家，重证据与营养学，逻辑严谨"></textarea>
          </div>
          <div class="group">
            <label>角色 B 预设</label>
            <textarea id="presetB" rows="4" placeholder="如：街头美食家，重口感与文化，语言活泼"></textarea>
          </div>

          <div class="group small">
            <label class="inline"><input id="judgePer" type="checkbox" checked> 逐回合裁判</label>
            <label class="inline"><input id="judgeFinal" type="checkbox" checked> 终局裁判</label>
            <select id="judgeModel" class="inline"></select>
          </div>

          <div class="group">
            <div class="label-row">
              <label>快捷角色预设</label>
              <button class="chip small role" data-a="产品经理（用户至上，度量与实验）" data-b="资深架构师（系统性、可靠性、成本）">PM ↔ 架构师</button>
              <button class="chip small role" data-a="美食科学家（营养、证据）" data-b="美食文化家（风味、文化）">科学 ↔ 文化</button>
              <button class="chip small role" data-a="乐观投资人（增长、愿景）" data-b="稳健财务官（盈利、风险）">VC ↔ CFO</button>
            </div>
          </div>
        </div>
      </div>

      <div class="sheet-footer">
        <span id="modelsInfo" class="muted">模型加载中…</span>
        <div class="spacer"></div>
        <button id="btn-save" class="btn primary">保存并收起</button>
      </div>
    </div>
  </div>

  <!-- 预载遮罩 -->
  <div class="boot" id="boot" hidden>
    <div class="boot-box">
      <div class="boot-title">初始化模型目录…</div>
      <div class="bar"><span id="bar" style="width:0%"></span></div>
      <div class="boot-tip" id="bootTip">请稍候</div>
    </div>
  </div>

  <!-- 吐司 -->
  <div id="toast" class="toast" hidden></div>

  <script>
    const baseRaw = {{ url_for('ai_duel.page') | tojson }};
    window.DUEL_BASE = baseRaw.endsWith('/') ? baseRaw : baseRaw + '/';
  </script>
  <script type="module" src="{{ url_for('ai_duel.static', filename='main.js') }}"></script>
</body>
</html>
