<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>AI 斗蛐蛐 · 若水的像素舞台</title>
  <link rel="stylesheet" href="{{ url_for('ai_duel.static', filename='main.css') }}">
</head>
<body>
<div id="duel-app">
  <!-- 启动遮罩（最多 1.2s） -->
  <div id="boot-mask">
    <div class="boot-box">
      <div class="spinner"></div>
      <div class="boot-text">加载模型目录中…</div>
      <div class="progress">
        <div class="progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- Hero 标题 -->
  <header class="hero">
    <h1>🤖 AI 斗蛐蛐 · 若水的像素舞台</h1>
    <div class="sub">两个 LLM 扮演不同角色围绕一个问题实时对话 · 可选裁判点评 / 终局裁决</div>
  </header>

  <!-- 顶部工具栏 -->
  <div class="toolbar">
    <div class="tool-grid">
      <div class="wide">
        <label class="small">主题</label>
        <input id="topic" class="input" placeholder="例如：薯条好吃还是汉堡好吃？"/>
        <div class="chips" id="topicChips">
          <span class="chip">薯条 vs 汉堡</span>
          <span class="chip">猫派 vs 狗派</span>
          <span class="chip">远程办公 vs 现场办公</span>
          <span class="chip">TypeScript 要不要上？</span>
        </div>
      </div>
      <div>
        <label class="small">回合</label>
        <select id="rounds" class="input">
          <option value="2">2</option>
          <option value="4" selected>4</option>
          <option value="6">6</option>
          <option value="8">8</option>
          <option value="10">10（上限）</option>
        </select>
      </div>
      <div>
        <label class="small">回复长度</label>
        <select id="replyStyle" class="input">
          <option value="short">短（1-2句）</option>
          <option value="medium" selected>中（2-4句）</option>
          <option value="long">长（4-6句）</option>
        </select>
      </div>
      <div class="center">
        <label class="toggle">
          <input type="checkbox" id="judgeOn" checked>
          <span>启用裁判</span>
        </label>
      </div>
      <div class="center">
        <label class="toggle">
          <input type="checkbox" id="judgePerRound" checked>
          <span>每轮点评</span>
        </label>
      </div>
      <div class="center">
        <button id="btnStart" class="btn btn-primary">开始对战</button>
      </div>
      <div class="quota" id="quotaBox">配额查询中…</div>
    </div>
  </div>

  <!-- 主布局 -->
  <div class="layout">
    <!-- 聊天面板 -->
    <section class="panel">
      <div class="panel-header">
        <div><strong>对战聊天</strong></div>
        <div>
          <button id="btnOpenPresetSheet" class="btn btn-ghost">预设生成器</button>
        </div>
      </div>
      <div class="panel-body">
        <div class="chat" id="chat"></div>
      </div>
    </section>

    <!-- 设置面板 -->
    <aside class="panel">
      <div class="panel-header"><strong>设置</strong></div>
      <div class="panel-body">
        <div class="section-title">模型选择</div>
        <div class="kv">
          <div><label class="small">A 模型</label></div>
          <div><select id="modelA" class="input"></select></div>
          <div><label class="small">B 模型</label></div>
          <div><select id="modelB" class="input"></select></div>
          <div><label class="small">裁判模型</label></div>
          <div><select id="judgeModel" class="input"></select></div>
        </div>

        <div class="section-title">角色预设</div>
        <div class="row">
          <label class="small">A 侧预设</label>
          <textarea id="mainPresetA" class="input" rows="5" placeholder="可留空，走通用提示；或手写系统预设"></textarea>
        </div>
        <div class="row">
          <label class="small">B 侧预设</label>
          <textarea id="mainPresetB" class="input" rows="5" placeholder="可留空，走通用提示；或手写系统预设"></textarea>
        </div>
        <div class="row"><span class="muted">不想手写？点击上方“预设生成器”一键扩写。</span></div>
      </div>
    </aside>
  </div>

  <!-- 预设生成器面板（遮罩先渲染，面板在上） -->
  <div id="presetSheet" class="sheet" aria-hidden="true">
    <div class="sheet__mask"></div>
    <div class="sheet__panel">
      <div class="panel-header" style="border:0;padding:0;margin-bottom:8px">
        <strong>预设生成器</strong>
        <button id="btnClosePresetSheet" class="btn">关闭</button>
      </div>
      <div class="row">
        <label class="small">生成模型（仅用于扩写预设，不影响对战）</label>
        <select id="builderModel" class="input"></select>
      </div>
      <div class="row">
        <label class="small">一句设定</label>
        <input id="presetSeed" class="input" placeholder="例如：‘美食节目导演 vs 只爱速食的电竞少年’"/>
      </div>
      <div class="row">
        <button id="btnGenPreset" class="btn btn-primary">
          <span id="genSpin" class="mini-spinner" aria-hidden="true"></span>
          AI 扩写
        </button>
      </div>
      <div class="grid2">
        <div>
          <label class="small">A 侧预设</label>
          <textarea id="presetA" class="input" rows="6"></textarea>
        </div>
        <div>
          <label class="small">B 侧预设</label>
          <textarea id="presetB" class="input" rows="6"></textarea>
        </div>
      </div>
      <div class="row">
        <button id="btnUsePreset" class="btn btn-apply">应用到对战设置</button>
      </div>
    </div>
  </div>
</div>

<script type="module" src="{{ url_for('ai_duel.static', filename='main.js') }}"></script>
</body>
</html>
