<!DOCTYPE html>
<html lang="zh-CN">
<head>
  {% include 'partials/_meta_pwa.html' %}
  {% block title %}<title>注册 - 每日塔罗运势</title>{% endblock %}
  <style>
    .password-strength{margin-top:6px;height:6px;background:rgba(255,255,255,.15);border-radius:3px;overflow:hidden}
    .password-strength-bar{height:100%;width:0%;transition:.3s;border-radius:3px;background:linear-gradient(90deg,#dc3545,#f0ad4e,#5cb85c)}
  </style>
</head>
<body>
  {% include 'partials/_bg_layers.html' %}
  {% include 'partials/_user_bar.html' %}

  <div class="main-container">
    <div class="glass-card auth-card">
      <div class="header">
        <div class="logo-icon" style="font-size:2.2rem;color:var(--gold-light);margin-bottom:8px"><i class="fas fa-sparkles"></i></div>
        <div class="title">创建账户</div>
        <div class="form-hint">加入塔罗世界，记录您的命运轨迹</div>
      </div>

      {% if error %}
        <div class="section" style="border-left:3px solid var(--danger)">
          <div class="content"><i class="fas fa-exclamation-circle"></i> {{ error }}</div>
        </div>
      {% endif %}

      <form method="POST" onsubmit="return validateForm()" style="margin-top:12px">
        <div class="form-group">
          <label for="username">用户名</label>
          <input type="text" id="username" name="username" placeholder="请输入用户名（至少3个字符）" required minlength="3">
        </div>

        <div class="form-group">
          <label for="password">密码</label>
          <input type="password" id="password" name="password" placeholder="请输入密码（至少6个字符）" required minlength="6" oninput="checkPasswordStrength()">
          <div class="password-strength"><div class="password-strength-bar" id="strength-bar"></div></div>
          <div class="form-hint">建议使用字母、数字和符号的组合</div>
        </div>

        <div class="form-group">
          <label for="confirm_password">确认密码</label>
          <input type="password" id="confirm_password" name="confirm_password" placeholder="请再次输入密码" required>
        </div>

        <button type="submit" class="btn-grad" style="width:100%;justify-content:center;margin-top:8px">
          <i class="fas fa-user-plus"></i> 立即注册
        </button>
      </form>

      <div class="divider"></div>

      <div class="footer" style="border-top:1px solid var(--border);padding-top:12px;margin-top:16px">
        已有账户？ <a href="{{ url_for('login') }}" style="color:var(--gold-light);text-decoration:underline">立即登录</a>
      </div>
    </div>
  </div>

  <script>
    function checkPasswordStrength() {
      const v = document.getElementById('password').value;
      const bar = document.getElementById('strength-bar');
      let s=0;
      if (v.length>=6) s++; if (v.length>=10) s++;
      if (/[a-z]/.test(v)) s++; if (/[A-Z]/.test(v)) s++; if (/[0-9]/.test(v)) s++; if (/[^a-zA-Z0-9]/.test(v)) s++;
      let w='0%'; if (s<=2) w='33%'; else if (s<=4) w='66%'; else w='100%';
      bar.style.width=w;
    }
    function validateForm(){
      const p = document.getElementById('password').value;
      const c = document.getElementById('confirm_password').value;
      if (p !== c){ alert('两次输入的密码不一致！'); return false; }
      return true;
    }
  </script>
  <script src="{{ url_for('static', filename='js/cosmos.js') }}"></script>
</body>
</html>
