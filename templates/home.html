<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Ruoshui Lab Â· å°å°å®éªŒå®¤</title>

  <!-- ä¾æ—§ä¿ç•™ä½ çš„èµ„æº -->
  <link rel="stylesheet" href="{{ url_for('static', filename='CSS/bootstrap.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='CSS/all.min.css') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&family=Noto+Sans+SC:wght@400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --ink-black:#1a1a1a; --paper-white:#fdfcf8; --sketch-gray:#4a4a4a;
      --eraser:#f0f0ed; --pencil-light:#888; --highlight:#ffeb3b;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Kalam','Noto Sans SC',cursive;
      background:var(--paper-white);
      color:var(--ink-black);
      min-height:100vh; position:relative; overflow-x:hidden;
    }
    /* çº¸å¼ çº¹ç†èƒŒæ™¯ */
    body::before{
      content:''; position:fixed; inset:0; opacity:.5; pointer-events:none;
      background-image:
        repeating-linear-gradient(0deg,transparent,transparent 28px,#e5e5e5 28px,#e5e5e5 29px),
        repeating-linear-gradient(90deg,transparent,transparent 1px,rgba(0,0,0,.03) 1px,rgba(0,0,0,.03) 2px);
      z-index:0;
    }
    /* èƒŒæ™¯æ¶‚é¸¦å®¹å™¨ */
    .doodles{position:fixed; inset:0; pointer-events:none; opacity:.1; z-index:0}
    .doodle{position:absolute; font-size:20px; transform:rotate(var(--rotation)); filter:blur(.5px)}

    /* ============== æ–°å¢ï¼šæ‰‹ç»˜é£ ç”¨æˆ·æ¡ï¼ˆé¡¶éƒ¨å›ºå®šï¼‰ ============== */
    .auth-bar{
      position:fixed; top:0; left:0; right:0; z-index:1000;
      background:rgba(253,252,248,.9);
      backdrop-filter:saturate(1.1);
      border-bottom:2px dashed rgba(0,0,0,.15);
      box-shadow:0 6px 12px rgba(0,0,0,.06);
    }
    .auth-inner{
      max-width:1200px; margin:0 auto; padding:10px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .auth-left{display:flex; align-items:center; gap:10px}
    .brand-sketch{
      font-weight:700; letter-spacing:.5px; display:inline-flex; align-items:center; gap:8px;
      transform:rotate(-1deg);
    }
    .brand-sketch::after{
      content:''; height:10px; background:var(--highlight); opacity:.35; display:block;
      transform:skewX(-15deg) translateY(-2px); border-radius:4px;
      width:64px;
    }

    .user-pill{
      display:flex; align-items:center; gap:10px;
      padding:6px 10px; border:2px solid var(--ink-black);
      border-radius:20px 6px 20px 6px; background:#fff; font-weight:700;
      box-shadow:3px 3px 0 rgba(0,0,0,.15);
    }
    .user-avatar{
      width:28px;height:28px;border-radius:50%;
      background:repeating-linear-gradient(135deg,#333,#333 6px,#666 6px,#666 12px);
      color:#fff; display:flex; align-items:center; justify-content:center;
      border:2px solid var(--ink-black); font-size:.95rem;
    }
    .user-name{font-weight:700}

    .auth-actions{display:flex; gap:10px; flex-wrap:wrap}
    .btn-sketch{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 14px; background:#fff; color:var(--ink-black);
      border:2px solid var(--ink-black);
      border-radius:6px 20px 6px 20px;
      font-weight:700; text-decoration:none; transition:.2s;
      box-shadow:3px 3px 0 rgba(0,0,0,.15);
    }
    .btn-sketch:hover{transform:translateY(-2px) rotate(-1deg)}
    .btn-sketch.ghost{background:transparent}
    .btn-sketch i{font-size:.95rem}

    @media (max-width:768px){
      .auth-inner{padding:8px 12px}
      .brand-sketch{font-size:.95rem}
      .auth-actions .btn-sketch{padding:7px 12px}
    }

    /* ============== é—ªæ¶ˆæ¯ï¼ˆç´ æåŒ–ï¼‰ ============== */
    .flash-messages{
      position:fixed; top:62px; right:16px; z-index:1001; max-width:360px;
    }
    .alert{
      border:2px solid var(--ink-black)!important;
      border-radius:12px 6px 12px 6px; padding:10px 12px;
      box-shadow:4px 4px 0 rgba(0,0,0,.15);
      background:#fff;
      color:#222;
    }
    .alert-success{background:#e8f9e9}
    .alert-info{background:#eef6ff}
    .alert-error,.alert-danger{background:#ffecec}
    .alert .close{background:none;border:0;font-size:1.2rem;line-height:1;color:#000;opacity:.7}
    .alert .close:hover{opacity:1}

    /* ä¸»å®¹å™¨ï¼ˆç»™é¡¶éƒ¨æ¡ç•™ç©ºé—´ï¼‰ */
    .notebook{
      max-width:1200px; margin:0 auto;
      padding: calc(40px + 70px) 20px 40px; /* é¡¶éƒ¨ +70px é¢„ç•™ç»™ auth-bar */
      position:relative; z-index:1;
    }

    /* æ ‡é¢˜ & æ‰‹ç»˜ä¸»ä½“ï¼ˆä¿ç•™ä½ çš„åŸæ ·ï¼‰ */
    .header{text-align:center; margin-bottom:60px; position:relative}
    .main-title{
      font-size:clamp(48px,8vw,72px); font-weight:700; display:inline-block; transform:rotate(-1deg); position:relative;
    }
    .main-title::before{
      content:''; position:absolute; bottom:-5px; left:-10px; right:-10px; height:20px;
      background:var(--highlight); opacity:.4; transform:rotate(1deg) skewX(-15deg); z-index:-1;
    }
    .main-title::after{
      content:''; position:absolute; top:50%; left:-60px; width:40px; height:40px;
      border:3px solid var(--ink-black); border-radius:50%;
      background:
        radial-gradient(circle at 30% 30%, transparent 8px, var(--ink-black) 8px, var(--ink-black) 10px, transparent 10px),
        radial-gradient(circle at 70% 30%, transparent 8px, var(--ink-black) 8px, var(--ink-black) 10px, transparent 10px);
    }
    .subtitle{
      font-size:18px; color:var(--sketch-gray); margin-top:10px; display:inline-block; position:relative;
    }
    .subtitle::before,.subtitle::after{
      content:'~'; position:absolute; top:50%; transform:translateY(-50%); font-size:30px; color:var(--pencil-light);
    }
    .subtitle::before{left:-30px} .subtitle::after{right:-30px}

    /* é¡¹ç›®ç½‘æ ¼ & å¡ç‰‡ï¼ˆä¿ç•™ä½ çš„åŸæ ·ï¼‰ */
    .sketches{display:grid; grid-template-columns:repeat(auto-fit,minmax(340px,1fr)); gap:40px; margin-bottom:80px}
    .sketch-card{background:var(--paper-white); position:relative; padding:20px; cursor:pointer; transition:transform .3s ease}
    .sketch-card::before{
      content:''; position:absolute; inset:0; border:2px solid var(--ink-black);
      border-radius:255px 15px 225px 15px/15px 225px 15px 255px;
      transform:rotate(var(--rotate,-.5deg)); transition:all .3s ease;
    }
    .sketch-card:nth-child(odd){--rotate:.5deg} .sketch-card:nth-child(even){--rotate:-.5deg}
    .sketch-card:hover{transform:translateY(-5px) scale(1.02)}
    .sketch-card:hover::before{border-width:3px; filter:drop-shadow(4px 4px 8px rgba(0,0,0,.1))}
    .sketch-area{height:200px; margin-bottom:20px; position:relative; display:flex; align-items:center; justify-content:center; background-size:cover; background-position:center; border:2px dashed var(--pencil-light); border-radius:5px}
    .sketch-area.no-cover{
      background:repeating-linear-gradient(45deg,transparent,transparent 10px,rgba(0,0,0,.02) 10px,rgba(0,0,0,.02) 20px);
    }
    .sketch-drawing{font-size:80px; color:var(--ink-black); position:relative; animation:sketch-wobble 3s ease-in-out infinite}
    @keyframes sketch-wobble{0%,100%{transform:rotate(-2deg) scale(1)}50%{transform:rotate(2deg) scale(1.05)}}
    .arrow-sketch{position:absolute; top:10px; right:10px; width:60px; height:60px}
    .arrow-sketch svg{width:100%; height:100%; stroke:var(--ink-black); stroke-width:2; fill:none; stroke-linecap:round; stroke-linejoin:round}
    .sketch-info{position:relative; padding:0 10px}
    .project-name{font-size:24px; font-weight:700; margin-bottom:10px; display:inline-block; position:relative}
    .project-name::after{content:''; position:absolute; bottom:-2px; left:0; right:0; height:2px; background:var(--ink-black); transform:scaleX(.8) skewX(-20deg); transform-origin:left}
    .project-note{font-size:16px; color:var(--sketch-gray); margin-bottom:20px; position:relative; padding-left:20px; min-height:1.5em}
    .project-note::before{content:'â†’'; position:absolute; left:0; top:0; font-size:20px}
    .tags-sketch{display:flex; flex-wrap:wrap; gap:10px; margin-bottom:25px}
    .tag-sketch{padding:5px 12px; border:1.5px solid var(--ink-black); border-radius:20px 5px 20px 5px; font-size:14px; transition:.2s}
    .tag-sketch:hover{background:var(--ink-black); color:var(--paper-white); transform:rotate(-3deg) scale(1.1)}
    .btn-enter{
      display:inline-flex; align-items:center; gap:10px; padding:12px 24px; background:none; border:2.5px solid var(--ink-black);
      color:var(--ink-black); text-decoration:none; font-size:18px; font-weight:700; border-radius:5px 20px 5px 20px; position:relative; transition:all .3s;
    }
    .btn-enter:hover{color:#fff; transform:rotate(-2deg) translateY(-2px)}
    .btn-enter:hover::before{opacity:1}
    .btn-enter::before{content:''; position:absolute; inset:-2px; background:var(--ink-black); border-radius:5px 20px 5px 20px; z-index:-1; opacity:0; transition:opacity .3s}

    /* è§’è½è£…é¥°/é¡µç ï¼ˆä¿ç•™ä½ çš„åŸæ ·ï¼‰ */
    .margin-notes{position:fixed; left:10px; top:50%; transform:translateY(-50%) rotate(-90deg); font-size:14px; color:var(--pencil-light); letter-spacing:2px}
    .page-number{position:fixed; bottom:20px; right:30px; font-size:16px; color:var(--pencil-light)}
    .corner-doodle{position:fixed; width:100px; height:100px; opacity:.3}
    .corner-doodle.top-left{top:20px; left:20px; transform:rotate(-15deg)}
    .corner-doodle.bottom-right{bottom:20px; right:20px; transform:rotate(15deg)}
    .sketch-area img{width:100%; height:100%; object-fit:cover; opacity:.9; filter:grayscale(20%) contrast(1.1)}

    /* å“åº”å¼ */
    @media (max-width:768px){
      .sketches{grid-template-columns:1fr; gap:30px}
      .main-title{font-size:40px}
      .main-title::after{display:none}
      .margin-notes,.corner-doodle{display:none}
      .flash-messages{top:56px; right:10px; max-width:86vw}
    }

    /* ç»˜åˆ¶åŠ¨ç”» */
    @keyframes draw{from{stroke-dashoffset:1000}to{stroke-dashoffset:0}}
    .draw-line{stroke-dasharray:1000; stroke-dashoffset:1000; animation:draw 2s ease forwards}
  </style>
</head>
<body>
  <!-- èƒŒæ™¯æ¶‚é¸¦ -->
  <div class="doodles" id="doodles"></div>

  <!-- é¡¶è§’è£…é¥° -->
  <div class="corner-doodle top-left">
    <svg viewBox="0 0 100 100">
      <path d="M20,50 Q50,20 80,50 T20,50" stroke="currentColor" stroke-width="2" fill="none"/>
      <circle cx="30" cy="40" r="3" fill="currentColor"/>
      <circle cx="70" cy="40" r="3" fill="currentColor"/>
    </svg>
  </div>
  <div class="corner-doodle bottom-right">
    <svg viewBox="0 0 100 100">
      <rect x="20" y="20" width="60" height="60" stroke="currentColor" stroke-width="2" fill="none" transform="rotate(45 50 50)"/>
      <line x1="20" y1="50" x2="80" y2="50" stroke="currentColor" stroke-width="2"/>
      <line x1="50" y1="20" x2="50" y2="80" stroke="currentColor" stroke-width="2"/>
    </svg>
  </div>

  <!-- ============== æ–°å¢ï¼šæ‰‹ç»˜é£ ç”¨æˆ·æ¡ ============== -->
  <div class="auth-bar">
    <div class="auth-inner">
      <div class="auth-left">
        <div class="brand-sketch">Ruoshui Lab</div>
      </div>
      <div class="auth-right">
        {% if user.is_guest %}
          <div class="auth-actions">
            <a class="btn-sketch" href="{{ url_for('login') }}"><i class="fas fa-sign-in-alt"></i> ç™»å½•</a>
            <a class="btn-sketch" href="{{ url_for('register') }}"><i class="fas fa-user-plus"></i> æ³¨å†Œ</a>
          </div>
        {% else %}
          <div class="user-pill" title="{{ user.username }}">
            <div class="user-avatar">{{ user.username[0]|upper }}</div>
            <span class="user-name">{{ user.username }}</span>
          </div>
          <div class="auth-actions" style="margin-left:10px">
            <a class="btn-sketch ghost" href="{{ url_for('stats') }}"><i class="fas fa-chart-line"></i> ç»Ÿè®¡</a>
            <a class="btn-sketch" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> é€€å‡º</a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- é—ªæ¶ˆæ¯ï¼ˆæ²¿ç”¨ Flask çš„ flashï¼‰ -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-messages">
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category in ['error','danger'] else category }}">
            <div style="display:flex;align-items:center;gap:10px">
              <strong style="transform:rotate(-2deg)">âœ</strong>
              <span>{{ message }}</span>
              <button type="button" class="close" onclick="this.closest('.alert').remove()">&times;</button>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- é¡µè¾¹æ³¨é‡Š / é¡µç  -->
  <div class="margin-notes">EXPERIMENTAL ZONE</div>
  <div class="page-number">Page 42</div>

  <!-- ä¸»å†…å®¹ -->
  <div class="notebook">
    <header class="header">
      <h1 class="main-title">Ruoshui LAB</h1>
      <p class="subtitle">éšä¾¿æç‚¹ä¸œè¥¿</p>
    </header>

    <main class="sketches">
      {% for p in projects %}
      <article class="sketch-card">
        <div class="arrow-sketch">
          <svg viewBox="0 0 60 60">
            {% if loop.index % 3 == 1 %}
              <path d="M10,30 L40,30 M40,30 L30,20 M40,30 L30,40" class="draw-line"/>
            {% elif loop.index % 3 == 2 %}
              <path d="M30,10 L30,40 M20,30 L30,40 L40,30" class="draw-line"/>
            {% else %}
              <circle cx="30" cy="30" r="20" stroke-dasharray="5,5" class="draw-line"/>
            {% endif %}
          </svg>
        </div>

        <div class="sketch-area {% if not p.cover %}no-cover{% endif %}"
             {% if p.cover %}style="background-image:url('{{ p.cover }}');"{% endif %}>
          {% if not p.cover %}
            <div class="sketch-drawing">
              {% if loop.index % 6 == 1 %}âš¡{% elif loop.index % 6 == 2 %}â™«{% elif loop.index % 6 == 3 %}âœï¸{% elif loop.index % 6 == 4 %}âš™ï¸{% elif loop.index % 6 == 5 %}ğŸ“Š{% else %}ğŸ’¡{% endif %}
            </div>
          {% endif %}
        </div>

        <div class="sketch-info">
          <h2 class="project-name">{{ p.title }}</h2>
          <p class="project-note">{{ p.subtitle }}</p>

          {% if p.tags %}
          <div class="tags-sketch">
            {% for tag in p.tags %}<span class="tag-sketch">{{ tag }}</span>{% endfor %}
          </div>
          {% endif %}

          <a href="{{ '/play/' ~ p.slug if p.type == 'template' else p.path }}" class="btn-enter">å¼€å§‹æ¢ç´¢ â†’</a>
        </div>
      </article>
      {% endfor %}
    </main>
  </div>

  <script>
    // ç”ŸæˆèƒŒæ™¯æ¶‚é¸¦ï¼ˆä¿ç•™ä½ çš„é€»è¾‘ï¼‰
    const doodlesContainer = document.getElementById('doodles');
    const doodleChars = ['â—‹','â–³','â–¡','â—‡','â˜†','â™¡','â†—','â†˜','~','Ã—','+','âˆ'];
    for(let i=0;i<30;i++){
      const d=document.createElement('div');
      d.className='doodle';
      d.textContent=doodleChars[Math.floor(Math.random()*doodleChars.length)];
      d.style.left=Math.random()*100+'%';
      d.style.top=Math.random()*100+'%';
      d.style.setProperty('--rotation', Math.random()*360+'deg');
      doodlesContainer.appendChild(d);
    }

    // å¡ç‰‡æ‘‡æ‘†æ•ˆæœï¼ˆä¿ç•™ä½ çš„é€»è¾‘ï¼‰
    document.querySelectorAll('.sketch-card').forEach((card, idx)=>{
      card.addEventListener('mouseenter',()=>card.style.setProperty('--rotate', (Math.random()-0.5)*3+'deg'));
      card.addEventListener('mouseleave',()=>card.style.setProperty('--rotate', idx%2===0?'-.5deg':'.5deg'));
    });

    // å¯è§†ç»˜åˆ¶
    const io=new IntersectionObserver(entries=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          e.target.querySelectorAll('.draw-line').forEach(l=>l.style.animation='draw 2s ease forwards');
        }
      })
    });
    document.querySelectorAll('.sketch-card').forEach(c=>io.observe(c));
  </script>
</body>
</html>
