<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>每日塔罗运势</title>

    <!-- 本地化 Bootstrap -->
    <link rel="stylesheet" href="{{ url_for('static', filename='CSS/bootstrap.min.css') }}">
    <!-- 本地化 Font Awesome -->
    <link rel="stylesheet" href="{{ url_for('static', filename='CSS/all.min.css') }}">

    <style>
        /* === 保留你原始 CSS === */
        :root {
            --primary-color: #8e6c88;
            --secondary-color: #d1bfa7;
            --accent-color: #6d4c67;
            --light-color: #f8f4e9;
            --dark-color: #333333;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8f4e9 0%, #e8e0d1 100%);
            color: var(--dark-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .user-bar { position: fixed; top: 0; left: 0; right: 0; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 10px 20px; z-index: 100; }
        .user-bar-content { max-width: 1200px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; }
        .user-info { display:flex; align-items:center; gap:15px; }
        .user-icon { width:36px; height:36px; background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; }
        .user-name { font-weight:600; color:var(--accent-color); }
        .user-actions { display:flex; gap:15px; }
        .user-actions a { color:var(--primary-color); text-decoration:none; font-size:0.95rem; padding:8px 16px; border-radius:20px; transition: all 0.3s; }
        .user-actions a:hover { background: rgba(142,108,136,0.1); color: var(--accent-color); }

        .tarot-container { max-width:800px; width:100%; margin:80px auto 20px; padding:30px; background: rgba(255,255,255,0.9); border-radius:20px; box-shadow:0 15px 30px rgba(0,0,0,0.1); text-align:center; position:relative; overflow:hidden; }
        .tarot-container::before { content:""; position:absolute; top:-10px; left:-10px; right:-10px; bottom:-10px; background: linear-gradient(45deg, var(--primary-color), var(--accent-color)); z-index:-1; border-radius:25px; }
        .header h1 { font-size:2.8rem; color:var(--accent-color); margin-bottom:10px; text-shadow:2px 2px 4px rgba(0,0,0,0.1); }
        .header p { font-size:1.2rem; color:var(--dark-color); max-width:600px; margin:0 auto; }
        .tarot-card { width:200px; height:320px; margin:0 auto 30px; background: linear-gradient(135deg, var(--secondary-color), #c0a58d); border-radius:15px; box-shadow:0 10px 25px rgba(0,0,0,0.15); display:flex; align-items:center; justify-content:center; position:relative; transform-style: preserve-3d; transition: transform 0.8s cubic-bezier(0.175,0.885,0.32,1.275); cursor:pointer; }
        .tarot-card:hover { transform: translateY(-10px) rotate(5deg); }
        .tarot-card i { font-size:4rem; color: rgba(109,76,103,0.3); }
        .tarot-card::after { content:""; position:absolute; top:15px; left:15px; right:15px; bottom:15px; border:2px solid rgba(109,76,103,0.2); border-radius:10px; }

        .action-section { margin:30px 0; }
        .btn-tarot { display:inline-flex; align-items:center; justify-content:center; background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); color:white; padding:15px 35px; border:none; border-radius:50px; font-size:1.2rem; font-weight:600; cursor:pointer; text-decoration:none; transition: all 0.3s ease; box-shadow:0 10px 20px rgba(142,108,136,0.3); }
        .btn-tarot:hover { transform: translateY(-3px); box-shadow:0 15px 25px rgba(142,108,136,0.4); }
        .btn-tarot i { margin-right:10px; }
        .info-text { font-size:1rem; color:var(--accent-color); margin-top:15px; }

        .features { display:flex; justify-content:space-around; flex-wrap:wrap; margin:40px 0; }
        .feature { flex:0 0 30%; min-width:200px; margin:10px; padding:20px; background:rgba(255,255,255,0.7); border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.05); transition: transform 0.3s ease; cursor:pointer; text-decoration:none; color:inherit; }
        .feature:hover { transform: translateY(-5px); }
        .feature i { font-size:2.5rem; color:var(--primary-color); margin-bottom:15px; }
        .feature h3 { font-size:1.3rem; color:var(--accent-color); margin-bottom:10px; }
        .feature p { font-size:0.95rem; color:var(--dark-color); }

        .footer { text-align:center; margin-top:30px; color:var(--accent-color); font-size:0.9rem; }

        .loading-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:9999; justify-content:center; align-items:center; }
        .loading-content { text-align:center; color:white; padding:30px; background: rgba(109,76,103,0.9); border-radius:15px; max-width:400px; }
        .spinner { width:50px; height:50px; border:5px solid rgba(255,255,255,0.3); border-radius:50%; border-top-color:white; animation:spin 1s linear infinite; margin:0 auto 20px; }
        @keyframes spin { to { transform:rotate(360deg); } }

        @media (max-width:768px){
            .tarot-container{padding:20px; margin-top:60px;}
            .header h1{font-size:2.2rem;}
            .tarot-card{width:180px;height:280px;}
            .btn-tarot{padding:12px 25px;font-size:1.1rem;}
            .feature{flex:0 0 100%;}
            .user-bar-content{font-size:0.9rem;}
            .user-actions{gap:10px;}
        }
    </style>
</head>
<body>
    <!-- 用户信息栏 -->
    <div class="user-bar">
        <div class="user-bar-content">
            <div class="user-info">
                <div class="user-icon">{{ (user.username[0]|upper) if not user.is_guest }}</div>
                <span class="user-name">{{ user.username if not user.is_guest else "访客" }}</span>
            </div>
            <div class="user-actions">
                {% if user.is_guest %}
                    <a href="{{ url_for('login') }}"><i class="fas fa-sign-in-alt"></i> 登录</a>
                    <a href="{{ url_for('register') }}"><i class="fas fa-user-plus"></i> 注册</a>
                {% else %}
                    <a href="{{ url_for('stats') }}"><i class="fas fa-chart-line"></i> 统计</a>
                    <a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> 退出</a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="tarot-container">
        <div class="header">
            <h1><i class="fas fa-star"></i> 每日塔罗运势 <i class="fas fa-star"></i></h1>
            <p>探索宇宙的奥秘，揭示今日的指引</p>
        </div>

        <div class="tarot-card"><i class="fas fa-question"></i></div>

        <div class="action-section">
            <form id="draw-form" action="{{ url_for('draw_card') }}" method="post">
                <button type="submit" class="btn-tarot">
                    <i class="fas fa-hand-sparkles"></i> 抽取今日塔罗牌
                </button>
            </form>
            <div class="info-text">点击按钮开始抽取今日塔罗牌</div>
        </div>

        <div class="features">
            <div class="feature">
                <i class="fas fa-moon"></i>
                <h3>每日指引</h3>
                <p>每天抽取一张塔罗牌，获取专属今日的宇宙指引和能量提示</p>
            </div>
            <div class="feature">
                <i class="fas fa-book-open"></i>
                <h3>深度解读</h3>
                <p>每张塔罗牌都有详尽的解释，帮助您理解牌面的深层含义</p>
            </div>
            <div class="feature" onclick="goHistory()">
                <i class="fas fa-history"></i>
                <h3>历史记录</h3>
                <p>保存您的抽卡记录，追踪每日的能量变化和成长轨迹</p>
            </div>
        </div>

        <div class="footer">© 2025 塔罗运势 | 宇宙能量，智慧指引</div>
    </div>

    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3>正在连接宇宙能量</h3>
            <p>塔罗牌正在揭示您的今日运势，请稍候...</p>
        </div>
    </div>

    <script>
        // 抽牌表单 loading 动画
        document.getElementById('draw-form')?.addEventListener('submit', function(e){
            e.preventDefault();
            document.getElementById('loading-overlay').style.display='flex';
            this.querySelector('button').disabled=true;
            setTimeout(()=>this.submit(), 1000);
        });

        // 历史记录跳转
        function goHistory(){
            {% if user.is_guest %}
                alert("请先登录才能查看历史记录！");
                window.location.href = "{{ url_for('login') }}";
            {% else %}
                window.location.href = "{{ url_for('stats') }}";
            {% endif %}
        }
    </script>
</body>

{% if is_guest and show_guest_tip %}
<div class="guest-welcome">
    <h3>欢迎，神秘的访客 ✨</h3>
    <div class="guest-info">
        <p>作为访客，您可以：</p>
        <ul>
            <li>每日抽取一张塔罗牌</li>
            <li>获得 AI 生成的专属解读</li>
            <li>导出保存今日的指引</li>
        </ul>
        {% if is_incognito_hint %}
        <div class="incognito-warning">
            <i class="icon-info"></i>
            <p>提示：您可能正在使用无痕浏览模式。关闭浏览器后，您的抽牌记录将会消失。</p>
        </div>
        {% endif %}
        <p class="register-prompt">
            想要保存历史记录并查看统计？
            <a href="{{ url_for('register') }}">立即注册</a>
        </p>
    </div>
</div>
{% endif %}

</html>
