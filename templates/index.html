<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>每日塔罗运势</title>
<link rel="stylesheet" href="{{ url_for('static', filename='CSS/bootstrap.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='CSS/all.min.css') }}">

<style>
:root {
    --primary-color: #8e6c88;
    --accent-color: #6d4c67;
    --light-bg: rgba(255,255,255,0.95);
    --border-light: rgba(142,108,136,0.1);
    --star-color: #ffd700;
}
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #f8f4e9 0%, #e8e0d1 100%);
    color: #333;
    min-height: 100vh;
    padding: 20px;
}
/* 顶部用户栏 */
.user-bar {position:fixed;top:0;left:0;right:0;background:rgba(255,255,255,0.9);backdrop-filter:blur(10px);box-shadow:0 2px 10px rgba(0,0,0,0.1);padding:10px 20px;z-index:100;}
.user-bar-content{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;}
.user-icon{width:36px;height:36px;background:linear-gradient(135deg,var(--primary-color),var(--accent-color));border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;}
.user-actions a{color:var(--primary-color);text-decoration:none;padding:8px 16px;border-radius:20px;transition:all .3s;}
.user-actions a:hover{background:rgba(142,108,136,0.1);color:var(--accent-color);}

/* 塔罗卡片抽牌区域 */
.tarot-container{max-width:900px;margin:100px auto 20px;padding:30px;background:var(--light-bg);border-radius:20px;box-shadow:0 15px 30px rgba(0,0,0,0.1);text-align:center;}
.header h1{font-size:2.5rem;color:var(--accent-color);}
.tarot-card{width:200px;height:320px;margin:0 auto 20px;background:linear-gradient(135deg,#d1bfa7,#c0a58d);border-radius:15px;box-shadow:0 10px 25px rgba(0,0,0,0.15);display:flex;align-items:center;justify-content:center;cursor:pointer;}
.btn-tarot{display:inline-flex;align-items:center;background:linear-gradient(135deg,var(--primary-color),var(--accent-color));color:#fff;padding:15px 35px;border:none;border-radius:50px;font-weight:600;box-shadow:0 10px 20px rgba(142,108,136,0.3);}
.btn-tarot:hover{transform:translateY(-3px);}

/* 运势卡片 */
.fortune-card{margin-top:20px;padding:25px;background:var(--light-bg);border-radius:20px;box-shadow:0 8px 20px rgba(0,0,0,0.1);border:2px solid var(--border-light);}
.fortune-title{text-align:center;font-size:1.6rem;color:var(--accent-color);margin-bottom:15px;font-weight:600;}
.overall-score{text-align:center;font-size:3rem;font-weight:bold;color:var(--primary-color);}
.score-label{text-align:center;font-weight:bold;color:var(--accent-color);margin-bottom:15px;}
.dimension-card{background:rgba(142,108,136,0.05);border:1px solid rgba(142,108,136,0.2);border-radius:12px;padding:15px;text-align:center;margin:5px;flex:0 0 120px;}
.dimension-stars{color:var(--star-color);margin:5px 0;}
.lucky-item{background:rgba(255,255,255,0.7);border-radius:10px;padding:10px;width:100px;margin:5px;text-align:center;}
.section-subtitle{font-weight:600;color:var(--accent-color);margin-top:20px;margin-bottom:10px;text-align:left;}
.detail-text p{margin:4px 0;}
.detail-text ul{padding-left:20px;margin:0;}
</style>
</head>
<body>
<div class="user-bar">
    <div class="user-bar-content">
        <div class="user-info">
            <div class="user-icon">
                {% if not user.is_guest %}{{ user.username[0]|upper }}{% else %}<i class="fas fa-user"></i>{% endif %}
            </div>
            <span>{{ user.username if not user.is_guest else "神秘访客" }}</span>
        </div>
        <div class="user-actions">
            {% if user.is_guest %}
                <a href="{{ url_for('login') }}"><i class="fas fa-sign-in-alt"></i> 登录</a>
                <a href="{{ url_for('register') }}"><i class="fas fa-user-plus"></i> 注册</a>
            {% else %}
                <a href="{{ url_for('stats') }}"><i class="fas fa-chart-line"></i> 统计</a>
                <a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> 退出</a>
            {% endif %}
        </div>
    </div>
</div>

<div class="tarot-container">
    <div class="header">
        <h1>每日塔罗运势</h1>
        <p>探索宇宙的奥秘，揭示今日的指引</p>
    </div>
    <div class="tarot-card"><i class="fas fa-question"></i></div>
    {% if not has_drawn %}
    <form id="draw-form" method="post" action="{{ url_for('draw_card') }}">
        <button class="btn-tarot"><i class="fas fa-hand-sparkles"></i>&nbsp;抽取今日塔罗牌</button>
    </form>
    {% else %}
    <div id="fortune-card" class="fortune-card" style="display:none;">
        <div class="fortune-title">今日运势</div>
        <div id="overall-score" class="overall-score"></div>
        <div id="score-label" class="score-label"></div>
        <div id="fortune-summary" class="detail-text" style="text-align:center;font-style:italic;"></div>

        <div class="section-subtitle">多维度评分</div>
        <div id="fortune-dimensions" style="display:flex;flex-wrap:wrap;justify-content:center;"></div>

        <div class="section-subtitle">幸运元素</div>
        <div id="lucky-elements" style="display:flex;flex-wrap:wrap;justify-content:center;"></div>

        <div class="section-subtitle">详细建议</div>
        <div id="dimension-advice" class="detail-text"></div>

        <div style="display:flex;justify-content:space-around;flex-wrap:wrap;margin-top:10px;">
            <div style="flex:1;min-width:150px;">
                <h5 style="color:var(--accent-color);">宜做</h5>
                <ul id="fortune-do"></ul>
            </div>
            <div style="flex:1;min-width:150px;">
                <h5 style="color:var(--accent-color);">忌做</h5>
                <ul id="fortune-dont"></ul>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded',()=>{
    const data = {{ fortune_data|tojson }};
    if(data && Object.keys(data).length>0){
        renderFortune(data);
    }
});
function renderFortune(data){
    document.getElementById('fortune-card').style.display='block';
    document.getElementById('overall-score').textContent=data.overall_score||'-';
    document.getElementById('score-label').textContent=data.overall_label||'';
    document.getElementById('fortune-summary').textContent=(data.fortune_text && data.fortune_text.summary)||data.summary||'';

    const dims=document.getElementById('fortune-dimensions');dims.innerHTML='';
    (data.dimensions||[]).forEach(dim=>{
        const stars=Array.from({length:5},(_,i)=>i<Math.round(dim.stars)?'★':'☆').join('');
        const card=document.createElement('div');
        card.className='dimension-card';
        card.innerHTML=`<div>${dim.name}</div><div class="dimension-stars">${stars}</div><div>${dim.level}</div>`;
        dims.appendChild(card);
    });

    const lucky=document.getElementById('lucky-elements');lucky.innerHTML='';
    const le=data.lucky_elements||{};
    Object.keys(le).forEach(k=>{
        const item=document.createElement('div');
        item.className='lucky-item';
        item.innerHTML=`<div>${k}</div><div>${le[k]}</div>`;
        lucky.appendChild(item);
    });

    const ft=data.fortune_text||{};
    const advice=document.getElementById('dimension-advice');advice.innerHTML='';
    if(ft.dimension_advice){
        Object.entries(ft.dimension_advice).forEach(([k,v])=>{
            const p=document.createElement('p');
            p.innerHTML=`<strong>${k}：</strong>${v}`;
            advice.appendChild(p);
        });
    }
    const doList=document.getElementById('fortune-do');doList.innerHTML='';
    (ft.do||[]).forEach(x=>{const li=document.createElement('li');li.textContent=x;doList.appendChild(li);});
    const dontList=document.getElementById('fortune-dont');dontList.innerHTML='';
    (ft.dont||[]).forEach(x=>{const li=document.createElement('li');li.textContent=x;dontList.appendChild(li);});
}
</script>
</body>
</html>
